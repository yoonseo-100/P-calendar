<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P Calendar</title>
    <link rel="stylesheet" href="../../common/css/reset.css">
    <link rel="stylesheet" href="../../common/css/style.css">
    <script src="../../common/js/jquery.min.js"></script>

    <style>

    </style>
</head>

<body>
    <section class="frame loca-calendar">
        <header></header>
        <nav>
            <div class="tabs">
                <a href="../home/index.html" class="tabItem">
                    <h4>홈</h4>
                </a>
                <button type="button" class="tabItem NOW">
                    <h4>개인일정</h4>
                </button>
            </div>
            <div class="control"></div>
        </nav>
        <div class="content">
            <div class="calendar" id="calendarContainer">
            <!-- Calendar rows will be generated by JavaScript -->
            </div>

            <script>
            // Configuration
            const WEEK_START = 'MON'; // Change to 'SUN' for Sunday start
            const CURRENT_DATE = new Date(2025, 11, 27); // Dec 27, 2025
            
            // Generate calendar
            function generateCalendar() {
            const container = document.getElementById('calendarContainer');
            const startMonth = 9; // October (0-indexed)
            const startYear = 2025;
            const monthsToGenerate = 6; // Oct, Nov, Dec 2025 + Jan, Feb, Mar 2026
            
            // Header row
            const headerRow = createHeaderRow();
            container.appendChild(headerRow);
            
            // Generate calendar rows
            let currentRow = null;
            let cellCount = 0;
            
            for (let m = 0; m < monthsToGenerate; m++) {
            const month = (startMonth + m) % 12;
            const year = startYear + Math.floor((startMonth + m) / 12);
            
            // Add month title
            const monthTitle = document.createElement('div');
            monthTitle.className = 'calRow type-month-title';
            monthTitle.innerHTML = `<h4>${year}년 ${month + 1}월</h4>`;
            monthTitle.setAttribute('data-month', `${year}-${month + 1}`);
            // container.appendChild(monthTitle);
            
            const result = generateMonthRows(container, year, month, currentRow, cellCount);
            currentRow = result.currentRow;
            cellCount = result.cellCount;
            }
            
            // Append remaining row if exists and fill to 7 cells
            if (currentRow && cellCount > 0) {
            while (cellCount < 7) {
            const emptyCell = document.createElement('div');
            emptyCell.className = 'calSell';
            currentRow.appendChild(emptyCell);
            cellCount++;
            }
            container.appendChild(currentRow);
            }
            
            // Scroll to current week
            scrollToCurrentWeek();
            // Setup sticky header
            setupStickyHeader();
            }
            
            function createHeaderRow() {
            const row = document.createElement('div');
            row.className = 'calRow type-head';
            
            const days = WEEK_START === 'MON' 
            ? ['MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT', 'SUN']
            : ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
            
            const korDays = WEEK_START === 'MON'
            ? ['월', '화', '수', '목', '금', '토', '일']
            : ['일', '월', '화', '수', '목', '금', '토'];
            
            days.forEach((day, idx) => {
            const cell = document.createElement('div');
            cell.className = 'calSell' + (idx >= 5 ? ' type-holi' : '');
            cell.innerHTML = `
            <div class="topic">
            <h5>${day}</h5>
            <h6>${korDays[idx]}</h6>
            </div>
            `;
            row.appendChild(cell);
            });
            
            return row;
            }
            
            // 일정 데이터
            const scheduleData = {
                types: ['해커톤 멘토', '외부 미팅', '내부 회의', '프로젝트 마감', '코드 리뷰', '팀 빌딩', '클라이언트 미팅', '기술 세미나'],
                timeSlots: [
                    { start: '09', end: '18' },
                    { start: '10', end: '12' },
                    { start: '14', end: '16' },
                    { start: '15', end: '17' },
                    { start: '09', end: '11' },
                    { start: '13', end: '15' }
                ]
            };

            function generateSchedulesForDate(date) {
                const weekNumber = Math.floor(date.getDate() / 7);
                
                let schedulesPerWeek;
                if (date < CURRENT_DATE) {
                    // 과거 날짜: 3~8개
                    schedulesPerWeek = Math.floor(Math.random() * 6) + 3;
                } else if (date.toDateString() === CURRENT_DATE.toDateString()) {
                    // 오늘: 3~8개
                    schedulesPerWeek = Math.floor(Math.random() * 6) + 3;
                } else {
                    // 미래 날짜 (type-yet): 0개 70%, 1~2개 30%
                    schedulesPerWeek = Math.random() < 0.9 ? 0 : Math.floor(Math.random() * 2) + 1;
                }
                
                let schedules = [];
                for (let i = 0; i < schedulesPerWeek; i++) {
                    const typeIdx = Math.floor(Math.random() * scheduleData.types.length);
                    const timeIdx = Math.floor(Math.random() * scheduleData.timeSlots.length);
                    const isDone = Math.random() > 0.4;
                    
                    schedules.push({
                        type: scheduleData.types[typeIdx],
                        time: scheduleData.timeSlots[timeIdx],
                        isDone: isDone
                    });
                }
                return schedules;
            }

            function createPlanHTML(schedules) {
                let html = '';
                schedules.forEach(schedule => {
                    const doneClass = schedule.isDone ? ' type-done' : '';
                    html += `
                    <div class="planItem${doneClass}">
                        <div class="time">
                            <span>${schedule.time.start}<br>~${schedule.time.end}</span>
                        </div>
                        <div class="info">
                            <h6>${schedule.type}</h6>
                        </div>
                    </div>
                    `;
                });
                return `<div class="plan">${html}</div>`;
            }

            // generateMonthRows 함수 수정
            function generateMonthRows(container, year, month, currentRow, cellCount) {
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startOffset = WEEK_START === 'MON' 
                ? firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1
                : firstDay.getDay();
                
                let dayCounter = 1;
                
                // Create new row only if no existing row
                if (!currentRow || cellCount === 0) {
                currentRow = document.createElement('div');
                currentRow.className = 'calRow type-body';
                currentRow.setAttribute('data-month', `${year}-${month + 1}`);
                cellCount = 0;
                }
                
                // Add padding for first week only if starting new row
                if (cellCount === 0) {
                for (let i = 0; i < startOffset; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calSell';
                currentRow.appendChild(emptyCell);
                cellCount++;
                }
                }
                
                // Add days of month
                for (let day = 1; day <= lastDay.getDate(); day++) {
                if (cellCount === 7) {
                container.appendChild(currentRow);
                currentRow = document.createElement('div');
                currentRow.className = 'calRow type-body';
                currentRow.setAttribute('data-month', `${year}-${month + 1}`);
                cellCount = 0;
                }
                
                const cell = document.createElement('div');
                const dayOfWeek = (startOffset + day - 1) % 7;
                const isHoliday = WEEK_START === 'MON' ? dayOfWeek >= 5 : dayOfWeek === 0 || dayOfWeek === 6;
                
                const cellDate = new Date(year, month, day);
                let className = 'calSell' + (isHoliday ? ' type-holi' : '');
                
                if (cellDate.toDateString() === CURRENT_DATE.toDateString()) {
                className += ' type-today';
                } else if (cellDate < CURRENT_DATE) {
                className += ' type-back';
                } else if (cellDate > CURRENT_DATE) {
                className += ' type-yet';
                }
                
                cell.className = className;
                cell.setAttribute('data-date', `${year}-${month + 1}-${day}`);
                
                const schedules = generateSchedulesForDate(cellDate);
                const planHTML = createPlanHTML(schedules);
                
                cell.innerHTML = `
                <div class="topic">
                <h5>${day}</h5>
                <h6 class="cont-weather">${Math.floor(Math.random() * 5) - 5}-${Math.floor(Math.random() * 10) + 5}˚</h6>
                </div>
                ${planHTML}
                `;
                
                currentRow.appendChild(cell);
                cellCount++;
                }
                
                return { currentRow, cellCount };
            }
            
            function scrollToCurrentWeek() {
            const dateStr = `${CURRENT_DATE.getFullYear()}-${CURRENT_DATE.getMonth() + 1}-${CURRENT_DATE.getDate()}`;
            const targetCell = document.querySelector(`[data-date="${dateStr}"]`);
            
            if (targetCell) {
            const container = document.querySelector('.content');
            const row = targetCell.closest('.calRow');
            const offset = row.offsetTop - container.offsetTop - 88;
            container.scrollTop = offset;
            }
            }
            
            function setupStickyHeader() {
            const contentDiv = document.querySelector('.content');
            const headerRow = document.querySelector('.calRow.type-head');
            const today = new Date();
            const todayCell = document.querySelector(`[data-date="${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}"]`);
            if (todayCell) {
                const dayOfWeek = todayCell.closest('.calRow').querySelector('.calSell').parentElement.children[Array.from(todayCell.parentElement.children).indexOf(todayCell)];
                const headerCells = document.querySelectorAll('.calRow.type-head .calSell');
                const todayDayOfWeek = today.getDay();
                const adjustedIndex = WEEK_START === 'MON' ? (todayDayOfWeek === 0 ? 6 : todayDayOfWeek - 1) : todayDayOfWeek;
                headerCells[adjustedIndex].classList.add('type-today');
            }
            const stickyContainer = document.createElement('div');
            stickyContainer.className = 'sticky-header calendar';
            stickyContainer.style.cssText = 'position: sticky; top: 0; background: white; z-index: 10; display: none;';
            
            const stickyMonth = document.createElement('div');
            stickyMonth.className = 'calRow type-month-title';
            stickyMonth.innerHTML = '<h4>2025년 10월</h4>';
            
            const stickyHeader = headerRow.cloneNode(true);
            stickyHeader.className = 'calRow type-head';
            
            stickyContainer.appendChild(stickyMonth);
            stickyContainer.appendChild(stickyHeader);
            contentDiv.insertBefore(stickyContainer, contentDiv.firstChild);
            
            contentDiv.addEventListener('scroll', () => {
            const offset = 100;
            const rows = Array.from(document.querySelectorAll('.calRow.type-body'));
            
            let currentMonth = '2025-10';
            for (let row of rows) {
            const rowTop = row.offsetTop - contentDiv.offsetTop;
            if (rowTop >= contentDiv.scrollTop + offset) {
            break;
            }
            currentMonth = row.getAttribute('data-month');
            }
            
            stickyMonth.innerHTML = `<h4>${currentMonth.split('-')[0]}년 ${currentMonth.split('-')[1]}월</h4>`;
            stickyContainer.style.display = 'block';
            });
            }
            
            // Initialize on page load
            document.addEventListener('DOMContentLoaded', generateCalendar);
            </script>
        </div>
        <footer></footer>
    </section>

</body>

</html>